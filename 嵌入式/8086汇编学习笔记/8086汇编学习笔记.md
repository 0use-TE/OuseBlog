# 8086 微机核心运行机制笔记

## 一、 启动与初始化（The Genesis）

1. **复位（Reset）**：通电瞬间，RESET 引脚高电平，CPU 内部寄存器强制归零，唯独 **CS = FFFFH**。
2. **第一条指令**：CPU 从 **FFFF0H**（FFFF:0000）处取指。这里通常放一条 `JMP` 指令，跳向 BIOS 固件。
3. **接力棒**：BIOS 完成自检（POST）后，从磁盘加载引导程序到内存，最终将控制权交给用户程序的入口地址。

## 二、 寻址机制：双重世界的交叠

8086 存在两个独立的地址空间，依靠控制信号区分。

### 1. 存储器寻址（1MB 空间）

* **计算公式**：`物理地址 = 段基址(CS/DS/SS/ES) × 16 + 偏移地址(IP/BX/SI/DI...)`。
* **控制信号**：当 **\$M/\\overline{IO} = H\$** 时，地址译码器指向 RAM 或 ROM 芯片。
* **分段意义**：用 16 位寄存器实现了 20 位物理地址的访问。

### 2. I/O 端口寻址（64KB 空间）

* **指令限制**：仅限 `IN` / `OUT` 指令，且必须经过 `AL/AX`。
* **控制信号**：当 **\$M/\\overline{IO} = L\$** 时，地址译码器指向接口芯片（如 8255A, 8253）。
* **编址方式**：独立编址。地址 `0060H` 在内存是数据，在 I/O 可能是键盘。

## 三、 核心芯片：CPU 的手眼耳

### 1. 8255A：并行搬运工（手）

* **角色**：通用接口，连接开关、LED、传感器、ADC。
* **核心逻辑**：
  * **控制字**：写入控制寄存器，定义 A、B、C 口的方向（输入/输出）。
  * **读写**：通过 `IN/OUT` 直接操作外设电平。

### 2. 8253：定时/计数器（心跳/闹钟）

* **角色**：产生固定频率脉冲，实现定时中断或 PWM 控制。
* **核心逻辑**：
  * **初值 **\$N\$****：**\$N = f\_{in} \\div f\_{out}\$**。
  * **减法计数**：每来一个脉冲 **\$N\$** 减 1，减到 0 时输出端（OUT）产生电平跳变。

### 3. 8259A：中断控制器（调度员）

* **角色**：管理多个外设的中断请求，处理优先级优先级排队。
* **核心逻辑**：从外设接收信号 **\$\\rightarrow\$** 捅 CPU 的 **INTR**\$\\rightarrow\$ 等待响应。

## 四、 中断机制：程序的“急停”与“恢复”

中断是微机处理突发事件的核心，本质是一次**由硬件触发的强制性子程序调用**。

1. **请求**：外设拉高 **INTR**。
2. **响应（握手）**：CPU 发出 **\$\\overline{INTA}\$** 脉冲，外设往数据总线上扔一个 **中断号（Type）**。
3. **查表**：CPU 计算 `中断号 × 4`，去 **中断向量表（IVT，00000H处）** 抓取新的 `CS:IP`。
4. **保护现场**：自动压入 **Flags、CS、IP** 到堆栈。
5. **服务与返回**：执行中断程序，最后以 `IRET` 指令弹栈，恢复现场。

## 五、 状态感知：标志寄存器（Flags）

标志位是 CPU 执行逻辑判断（if-else）的唯一依据：

* **ZF (Zero)**：结果为 0 时起立。
* **SF (Sign)**：结果为负（最高位为 1）时起立。
* **CF/OF**：处理无符号/有符号溢出的界限。
* **IF (Interrupt)**：全局中断开关。`STI` 开启，`CLI` 关闭。

## 六、 运行机制总结（口诀）

> 地址译码选芯片，IN/OUT 搬数据。
> 
> 时钟脉冲推时序，中断号里找程序。
> 
> 算术逻辑看标志，堆栈里面存记忆。
> 
> 软硬结合跑闭环，八零八六玩逻辑。

